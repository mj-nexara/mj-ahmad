#!/bin/bash

# ┌────────────────────────────────────────────┐
# │ Nexara Snap Installer — Modular & Branded │
# └────────────────────────────────────────────┘

APP_NAME="gs"
VERSION="1.0.0"
SNAP_FILE="${APP_NAME}_${VERSION}_amd64.snap"
LOG_PATH="../logs/install.log"
BRAND="Nexara"
BORDER="────────────────────────────────────────────"

echo ""
echo "🔷 $BRAND Installer: Preparing to install $APP_NAME v$VERSION"
echo "$BORDER" | tee -a "$LOG_PATH"
echo "📁 Working Directory: $(pwd)" | tee -a "$LOG_PATH"
echo "📄 Target File: $SNAP_FILE" | tee -a "$LOG_PATH"
echo "🕒 Timestamp: $(date)" | tee -a "$LOG_PATH"
echo "$BORDER" >> "$LOG_PATH"

# Check for snap file
if [ ! -f "$SNAP_FILE" ]; then
  echo "❌ Error: $SNAP_FILE not found in $(pwd)"
  echo "🚫 Installation aborted." | tee -a "$LOG_PATH"
  echo "[$(date)] ERROR: File not found — $SNAP_FILE" >> "$LOG_PATH"
  exit 1
fi

# Install snap
echo "📦 Installing $APP_NAME using Snap..."
sudo snap install --devmode "./$SNAP_FILE" >> "$LOG_PATH" 2>&1

# Check result
if [ $? -eq 0 ]; then
  echo "✅ Success: $APP_NAME v$VERSION installed!"
  echo "[$(date)] SUCCESS: Installed $APP_NAME v$VERSION" >> "$LOG_PATH"
else
  echo "❌ Failure: Installation encountered an error."
  echo "[$(date)] ERROR: Snap install failed" >> "$LOG_PATH"
fi

echo "$BORDER" >> "$LOG_PATH"
echo "📜 Log saved to: $LOG_PATH"
echo ""

